{% extends 'base.html' %}
{% block content %}
  <style>
    /* Custom CSS to style the form */
    .form-group {
      margin-bottom: 20px;
      
    }
    label{margin-left: 20px;} 
		#datepicker1{width:180px;} 
    #datepicker2{width:180px}
		#datepicker1 > span:hover{cursor: pointer;}
  </style>
</head>
<body>
  <h1 class="container"> Welcome, {{ current_user.username }} üëãüèø</h1>
  <br>
  <h2>Reporting Period </h2>

  <div class="container">
    <label>From: </label>
      <div id="datepicker1" class="input-group date" data-date-format="mm-dd-yyyy"> 
        <input class="form-control" type="text" readonly /> 
        <span class="input-group-addon">  
          <i class="bi-calendar-event-fill" style="font-size: 2rem; color: cornflowerblue;"></i>
        </span>
      </div> 
      <label>To: </label>
      <div id="datepicker2" class="input-group date" data-date-format="mm-dd-yyyy"> 
        <input class="form-control" type="text" readonly /> 
        <span class="input-group-addon"> 
          <i class="bi-calendar-event-fill" style="font-size: 2rem; color: cornflowerblue;"></i> 
        </span>
      </div>
  </div>

  <h2 class="text-center">Transportation Consumption Form</h2>
  <div class="container">
    <form> 
      <div class="form-group row" id="motorVehicle">    
        <div class="col">   
          <label for="car_diesel">Motor Vehicle (litres)</label>
          <input type="text" class="form-control" id="motor_vehicle" name="motor_vehicle" >
        </div>
        <div class="col">
          <label for="fuelType">Select Fuel Type:</label>
          <select name="fuelType" class="form-select" aria-label="Default select example">
            <option selected value="petrol">Petrol</option>
            <option value="diesel">Diesel</option>
          </select>
        </div>
        <div class="col">
          <label for="fuel_price">Total Cost (Naira)</label>
          <input type="text" class="form-control" id="motor_price" name="motor_price">
        </div>
      </div>
      <button type="button" onclick="addInput('motorVehicle')">Add More Motor Vehicles</button>
      <div class="form-group row" id="motorbike">
        <div class="col">
          <label for="motorbike">Motorbike (litres)</label>
          <input type="text" class="form-control" id="motorbike" name="motorbike">
        </div>
        <div class="col">
          <label for="fuelType">Select Fuel Type:</label>
          <select name="fuelType2" class="form-select" aria-label="Default select example">
            <option selected value="petrol">Petrol</option>
            <option value="diesel">Diesel</option>
          </select>
        </div>
        <div class="col">
          <label for="motorbike_price">Total Cost (Naira)</label>
          <input type="text" class="form-control" id="motorbike_price" name="motorbike_price">
        </div>
      </div>
      <button type="button" onclick="addInput('motorbike')">Add More Motorbikes</button>
      <div class="form-group row" id="tricycle">
        <div class="col">
          <label for="tricycle">Tricycle (litres)</label>
          <input type="text" class="form-control" id="tricycle" name="tricycle">
        </div>
        <div class="col">
          <label for="fuelType">Select Fuel Type:</label>
          <select name="fuelType3" class="form-select" aria-label="Default select example">
            <option selected value="petrol">Petrol</option>
            <option value="diesel">Diesel</option>
          </select>
        </div>
        <div class="col">
          <label for="tricycle_price">Total Cost (Naira)</label>
          <input type="text" class="form-control" id="tricycle_price" name="tricycle_price">
        </div>
      </div>
      <button type="button" onclick="addInput('tricycle')">Add More Tricycle</button>
      <div class="form-group row" id="flightDomestic">
        <div class="col">
          <label for="flight_domestic">Flight (Domestic) (Km Travelled)</label>
          <input type="text" class="form-control" id="flight_domestic" name="flight_domestic">
        </div>
        <div class="col">
          <label for="flight_domestic_price">Total Cost (Naira)</label>
          <input type="text" class="form-control" id="flight_domestic_price" name="flight_domestic_price">
        </div>
      </div>
      <div class="form-group row" id="flightInternational">
        <div class="col">
          <label for="flight_international">Flight (International) (Km Travelled)</label>
          <input type="text" class="form-control" id="flight_international" name="flight_international">
        </div>
        <div class="col">
          <label for="flight_international_price">Total Cost (Naira)</label>
          <input type="text" class="form-control" id="flight_international_price" name="flight_international_price">
        </div>
      </div>


      <!-- this is the beginning of the merge -->
      <h2 class="text-center">Enerygy Consumption form </h2>
      <div class="form-group row" id="electricity">
        <div class="col">
          <label for="electricity">Electricity (kWh)</label>
          <input type="text" class="form-control" id="electricity" name="electricity">
        </div>
        <div class="col">
          <label for="electricity_price">Total Cost (Naira)</label>
          <input type="text" class="form-control" id="electricity_price" name="electricity_price">
        </div>
      </div>
      <div class="form-group row" id="generator">
        <div class="col">
          <label for="generator">Generator (litres)</label>
          <input type="text" class="form-control" id="generator" name="generator">
        </div>
        <div class="col">
          <label for="fuelType">Select Fuel Type:</label>
          <select name="fuelType4" class="form-select" aria-label="Default select example">
            <option selected value="petrol">Petrol</option>
            <option value="diesel">Diesel</option>
          </select>
        </div>
        <div class="col">
          <label for="fuel_price">Total Cost (Naira)</label>
          <input type="text" class="form-control" id="generator_price" name="generator_price">
        </div>
      </div>
      <button type="button" onclick="addInput('generator')">Add More Generators</button>
      <div class="form-group row" id="lpg">
        <div class="col">
          <label for="lpg">LPG (cooking gas) (litres)</label>
          <input type="text" class="form-control" id="lpg" name="lpg">
        </div>
        <div class="col">
          <label for="lpg_price">Total Cost (Naira)</label>
          <input type="text" class="form-control" id="lpg_price" name="lpg_price">
        </div>
      </div>
      <div class="form-group row" id="firewood">
        <div class="col">
          <label for="coal">Coal (firewood) (tonnes)</label>
          <input type="text" class="form-control" id="coal" name="coal">
        </div>
        <div class="col">
          <label for="coal_price">Total Cost (Naira)</label>
          <input type="text" class="form-control" id="coal_price" name="coal_price">
        </div>
      </div>

      <!-- this is the end -->

      <button type="submit" class="btn btn-primary" onclick="submitForm(event)">Calculate</button>
    </form>
  </div>



  <script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script> 

  <script>

function addInput(containerId) {
    var container = document.getElementById(containerId);
    var newInput = container.cloneNode(true);

    // Append the cloned input fields to the form
    container.parentNode.insertBefore(newInput, container.nextSibling);
}

async function submitForm(event) {
    try {

        event.preventDefault();
        // Gather form data
        var formData = {
            motorVehicle: serializeInputs('motorVehicle'),
            motorbike: serializeInputs('motorbike'),
            tricycle: serializeInputs('tricycle'),
            flightDomestic: serializeInputs('flightDomestic'),
            flightInternational: serializeInputs('flightInternational'),
            electricity: serializeInputs('electricity'),
            generator: serializeInputs('generator'),
            lpg: serializeInputs('lpg'),
            firewood: serializeInputs('firewood')
            // Add more sections as needed for other form fields
        };

        // Serialize form data to JSON
        var jsonData = JSON.stringify(formData);

        // Send POST request to Flask backend
        const response = await fetch('/calculatee', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: jsonData
        });

        // Handle response from Flask backend
        if (!response.ok) {
            throw new Error('Failed to send data to server');
        }

        // Do something with the response if needed
    } catch (error) {
        console.error('Error:', error);
    }
}

function serializeInputs(containerId) {
    var container = document.getElementById(containerId);
    var inputs = container.querySelectorAll('input, select');
    var values = {};

    inputs.forEach(input => {
        values[input.name] = input.value;
    });

    return values;
}

$(function () { 
        $("#datepicker1").datepicker({  
            autoclose: true,  
            todayHighlight: true, 
            todayBtn : "linked",  
          }).datepicker('update', new Date()); 
        }); 

$(function () { 
    $("#datepicker2").datepicker({  
        autoclose: true,  
        todayHighlight: true, 
        todayBtn : "linked",  
    }).datepicker('update', new Date()); 
});

  </script>
{% endblock content %}