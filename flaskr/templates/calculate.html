{% extends 'base.html' %}
{% block content %}
  <style>
    /* Custom CSS to style the form */
    .form-group {
      margin-bottom: 20px;
      
    }
    label{margin-left: 20px;} 
		#datepicker1{width:180px;} 
    #datepicker2{width:180px}
		#datepicker1 > span:hover{cursor: pointer;}
  </style>
</head>
<body>
  <h1 class="container"> Welcome, {{ current_user.username }} üëãüèø</h1>
  <br>
  <h2>Reporting Period </h2>

  <div class="container">
    <label>From: </label>
      <div id="datepicker1" class="input-group date" data-date-format="mm-dd-yyyy"> 
        <input class="form-control" type="text" readonly /> 
        <span class="input-group-addon">  
          <i class="bi-calendar-event-fill" style="font-size: 2rem; color: cornflowerblue;"></i>
        </span>
      </div> 
      <label>To: </label>
      <div id="datepicker2" class="input-group date" data-date-format="mm-dd-yyyy"> 
        <input class="form-control" type="text" readonly /> 
        <span class="input-group-addon"> 
          <i class="bi-calendar-event-fill" style="font-size: 2rem; color: cornflowerblue;"></i> 
        </span>
      </div>
  </div>

  <h2 class="text-center">Transportation Consumption Form</h2>
  <div class="container">
    <form action="/calculate" method="post" id="transport-form"> 
      <div class="form-group row">    
        <div class="col">   
          <label for="car_diesel">Motor Vehicle (litres)</label>
          <input type="number" class="form-control" id="motor_vehicle" name="motor_vehicle" required step="any">
        </div>
        <div class="col">
          <label for="fuelType">Select Fuel Type:</label>
          <select name="fuelType" class="form-select" aria-label="Default select example">
            <option selected value="petrol">Petrol</option>
            <option value="diesel">Diesel</option>
          </select>
        </div>
        <div class="col">
          <label for="fuel_price">Total Cost (Naira)</label>
          <input type="number" class="form-control" id="motor_price" name="motor_price" required step="any">
        </div>
      </div>
      <div class="form-group row">
        <div class="col">
          <label for="motorbike">Motorbike (litres)</label>
          <input type="number" class="form-control" id="motorbike" name="motorbike" required step="any">
        </div>
        <div class="col">
          <label for="fuelType">Select Fuel Type:</label>
          <select name="fuelType2" class="form-select" aria-label="Default select example">
            <option selected value="petrol">Petrol</option>
            <option value="diesel">Diesel</option>
          </select>
        </div>
        <div class="col">
          <label for="motorbike_price">Total Cost (Naira)</label>
          <input type="number" class="form-control" id="motorbike_price" name="motorbike_price" required step="any">
        </div>
      </div>
     
      <div class="form-group row">
        <div class="col">
          <label for="tricycle">Tricycle (litres)</label>
          <input type="number" class="form-control" id="tricycle" name="tricycle" required step="any">
        </div>
        <div class="col">
          <label for="fuelType">Select Fuel Type:</label>
          <select name="fuelType3" class="form-select" aria-label="Default select example">
            <option selected value="petrol">Petrol</option>
            <option value="diesel">Diesel</option>
          </select>
        </div>
        <div class="col">
          <label for="tricycle_price">Total Cost (Naira)</label>
          <input type="number" class="form-control" id="tricycle_price" name="tricycle_price" required step="any">
        </div>
      </div>
      <div class="form-group row">
        <div class="col">
          <label for="flight_domestic">Flight (Domestic) (Km Travelled)</label>
          <input type="number" class="form-control" id="flight_domestic" name="flight_domestic" required step="any">
        </div>
        <div class="col">
          <label for="flight_domestic_price">Total Cost (Naira)</label>
          <input type="number" class="form-control" id="flight_domestic_price" name="flight_domestic_price" required step="any">
        </div>
      </div>
      <div class="form-group row">
        <div class="col">
          <label for="flight_international">Flight (International) (Km Travelled)</label>
          <input type="number" class="form-control" id="flight_international" name="flight_international" required step="any">
        </div>
        <div class="col">
          <label for="flight_international_price">Total Cost (Naira)</label>
          <input type="number" class="form-control" id="flight_international_price" name="flight_international_price" required step="any">
        </div>
      </div>


      <!-- this is the beginning of the merge -->
      <h2 class="text-center">Enerygy Consumption form </h2>
      <div class="form-group row">
        <div class="col">
          <label for="electricity">Electricity (kWh)</label>
          <input type="number" class="form-control" id="electricity" name="electricity" required step="any">
        </div>
        <div class="col">
          <label for="electricity_price">Total Cost (Naira)</label>
          <input type="number" class="form-control" id="electricity_price" name="electricity_price" required step="any">
        </div>
      </div>
      <div class="form-group row">
        <div class="col">
          <label for="generator">Generator (litres)</label>
          <input type="number" class="form-control" id="generator" name="generator" required step="any">
        </div>
        <div class="col">
          <label for="fuelType">Select Fuel Type:</label>
          <select name="fuelType4" class="form-select" aria-label="Default select example">
            <option selected value="petrol">Petrol</option>
            <option value="diesel">Diesel</option>
          </select>
        </div>
        <div class="col">
          <label for="fuel_price">Total Cost (Naira)</label>
          <input type="number" class="form-control" id="generator_price" name="generator_price" required step="any">
        </div>
      </div>
      <div class="form-group row">
        <div class="col">
          <label for="lpg">LPG (cooking gas) (litres)</label>
          <input type="number" class="form-control" id="lpg" name="lpg" required step="any">
        </div>
        <div class="col">
          <label for="lpg_price">Total Cost (Naira)</label>
          <input type="number" class="form-control" id="lpg_price" name="lpg_price" required step="any">
        </div>
      </div>
      <div class="form-group row">
        <div class="col">
          <label for="coal">Coal (firewood) (tonnes)</label>
          <input type="number" class="form-control" id="coal" name="coal" required step="any">
        </div>
        <div class="col">
          <label for="coal_price">Total Cost (Naira)</label>
          <input type="number" class="form-control" id="coal_price" name="coal_price" required step="any">
        </div>
      </div>

      <!-- this is the end -->

      <button type="submit" class="btn btn-primary">Calculate</button>
    </form>
  </div>

  <div class="container">
    <h1 class="text-center">Total Consumption Bar Chart</h1>
    <canvas id="myChart"></canvas>
  </div>

  <div style="max-width: 600px; margin: auto;" class="container">
    <h1 class="text-center">Total Consumption Pie Chart</h1>
    <canvas id="myPieChart"></canvas>
  </div>

  <div style="max-width: 600px; margin: auto;" class="container">
    <h1 class="text-center">Consumption Pie Chart</h1>
    <canvas id="myPieChart2"></canvas>
  </div>


  <div class="container">
    <h1>Total Footprint = {{ total_coefficient }} metric tons of CO2e </h1>
    <p><strong> {{ motor_vehicle_coefficient }} metric tons: </strong></p>
    <p><strong> {{ motorbike_coefficient }} metric tons: </strong></p>
    <p><strong> {{ tricycle_coefficient }} metric tons: </strong></p>
    <p><strong> {{ domestic_flight_coefficient }} metric tons: </strong></p>
    <p><strong> {{ inter_flight_coefficient }} metric tons: </strong></p>
    <p><strong> {{ electricity_coefficient }} metric tons: </strong></p>
    <p><strong> {{ generator_coefficient }} metric tons: </strong></p>
    <p><strong> {{ lpg_coefficient }} metric tons: </strong></p>
    <p><strong> {{ coal_coefficient }} metric tons:  </strong></p>
    <p>Total amount spent is {{ total_cost }}</p>


  </div>
  <script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script> 

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const labels = JSON.parse('{{ labels | safe }}');
      const data = JSON.parse('{{ data | safe }}');

      // Create bar chart
      const ctx = document.getElementById('myChart').getContext('2d');
      const myChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: 'Total Consumption',
            data: data,
            backgroundColor: 'rgba(54, 162, 235, 0.5)', // Blue color with transparency
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1
          }]
        },
        options: {
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    });

    document.addEventListener('DOMContentLoaded', function () {
      const pie_labels = JSON.parse('{{ labels | safe }}');
      const pie_data = JSON.parse('{{ data | safe }}');

      // Create pie chart
      const ctx = document.getElementById('myPieChart').getContext('2d');
      const myChart = new Chart(ctx, {
        type: 'pie',
        data: {
          labels: pie_labels,
          datasets: [{
            label: 'Total Consumption',
            data: pie_data,
            backgroundColor: [
              'rgba(255, 99, 132, 0.5)', // Red color with transparency
              'rgba(54, 162, 235, 0.5)', // Blue color with transparency
              'rgba(255, 206, 86, 0.5)', // Yellow color with transparency
              'rgba(75, 192, 192, 0.5)', // Green color with transparency
              'rgba(153, 102, 255, 0.5)', // Purple color with transparency
              'rgba(255, 159, 64, 0.5)', // Orange color with transparency
              'rgba(255, 99, 132, 0.5)', // Red color with transparency (repeat to cover more colors)
              'rgba(191, 63, 191, 0.6)'
            ],
            borderColor: [
              'rgba(255, 99, 132, 1)',
              'rgba(54, 162, 235, 1)',
              'rgba(255, 206, 86, 1)',
              'rgba(75, 192, 192, 1)',
              'rgba(153, 102, 255, 1)',
              'rgba(255, 159, 64, 1)',
              'rgba(255, 99, 132, 1)',
              'rgba(191, 63, 191, 1)'
            ],
            borderWidth: 1
          }]
        },
        options: {
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    });
 
    document.addEventListener('DOMContentLoaded', function () {
      // const energy_label = JSON.parse('{{ coefficient_label | safe }}');
      const coeff_data = JSON.parse('{{ sum_of_coefficient | safe }}');
      console.log(coeff_data)
      console.log('hi')

      // Create pie chart
      const ctx = document.getElementById('myPieChart2').getContext('2d');
      const myChart = new Chart(ctx, {
        type: 'pie',
        data: {
          labels: ["Transportation", "Energy"],
          datasets: [{
            label: 'Test Consumption',
            data: coeff_data,
            backgroundColor: [
              'rgba(255, 99, 132, 0.5)', // Red color with transparency
              'rgba(54, 162, 235, 0.5)', // Blue color with transparency
            ],
            borderColor: [
              'rgba(255, 99, 132, 1)',
              'rgba(54, 162, 235, 1)'
            ],
            borderWidth: 1
          }]
        },
        options: {
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    });

    $(function () { 
        $("#datepicker1").datepicker({  
            autoclose: true,  
            todayHighlight: true, 
            todayBtn : "linked",  
          }).datepicker('update', new Date()); 
        }); 

    $(function () { 
        $("#datepicker2").datepicker({  
            autoclose: true,  
            todayHighlight: true, 
            todayBtn : "linked",  
        }).datepicker('update', new Date()); 
    });
  </script>
{% endblock content %}
